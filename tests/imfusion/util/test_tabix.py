import pytest

from imfusion.util import tabix


class TestFlattenIntervals(object):
    """Unit tests for flatten_intervals function."""

    # def test_example(self):
    #     """Tests example case."""

    #     ranges = [(10, 12), (12, 15), (15, 20), (20, 30), (30, 32), (45, 55)]
    #     flattened = list(genomic.flatten_intervals(ranges))

    #     assert flattened == [(10, 12), (12, 15), (15, 20), (20, 30), (30, 32), (45, 55)]

    def test_smn1(self, test_intervals, flattened_test_intervals):
        """Test Smn1 example."""
        flattened = list(tabix._flatten_intervals(test_intervals))
        assert flattened == flattened_test_intervals

    def test_empty(self):
        """Test empty example."""
        flattened = list(tabix._flatten_intervals([]))
        assert flattened == []


@pytest.fixture
def test_intervals():
    """Example intervals for Smn1."""

    return [
        (100124852, 100124965), (100124858, 100124965), (100124858, 100124965),
        (100124894, 100124965), (100124924, 100124965), (100125819, 100125931),
        (100126125, 100126658), (100126587, 100126658), (100126587, 100126658),
        (100126587, 100126658), (100126870, 100126989), (100126870, 100126989),
        (100126870, 100126935), (100126870, 100127142), (100127805, 100127812),
        (100127805, 100128005), (100127805, 100128005), (100127875, 100128005),
        (100128215, 100128361), (100128215, 100128361), (100128215, 100128630),
        (100131003, 100131175), (100131080, 100131174), (100131080, 100131175),
        (100132356, 100132466), (100132356, 100132466), (100135393, 100135739),
        (100135689, 100135739), (100135689, 100135739), (100135689, 100135739),
        (100137381, 100137480), (100137381, 100137690), (100137381, 100137450),
        (100137387, 100137690)
    ]


@pytest.fixture
def flattened_test_intervals():
    """Flattened test intervals for Smn1."""
    return [
        (100124852, 100124857), (100124858, 100124893), (100124894, 100124923),
        (100124924, 100124965), (100125819, 100125931), (100126125, 100126586),
        (100126587, 100126658), (100126870, 100126935), (100126936, 100126989),
        (100126990, 100127142), (100127805, 100127812), (100127813, 100127874),
        (100127875, 100128005), (100128215, 100128361), (100128362, 100128630),
        (100131003, 100131079), (100131080, 100131174), (100131175, 100131175),
        (100132356, 100132466), (100135393, 100135688), (100135689, 100135739),
        (100137381, 100137386), (100137387, 100137450), (100137451, 100137480),
        (100137481, 100137690)
    ]
